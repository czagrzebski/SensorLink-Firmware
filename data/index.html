<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SensorLink</title>
        <!-- Add Font Awesome link -->

        <style>
            /* Styles remain the same as before */
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }

            .content {
                flex: 1;
                /* Add padding or margins as needed */
            }

            nav {
                background-color: #333;
                color: white;
                padding: 10px 30px;
                /* Adjusted navbar height */
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            nav h1 {
                margin: 0;
                /* Resetting margin */
            }

            nav ul {
                list-style: none;
                margin: 0;
                padding: 0;
                display: flex;
                align-items: center;
                /* Align items vertically */
            }

            nav ul li {
                margin-right: 20px;
            }

            nav ul li a {
                color: white;
                text-decoration: none;
            }

            #status-items {
                font-size: 14px;
                display: flex;
                align-items: center;
                color: #ccc;
                /* Color for WiFi info */
                margin-left: auto;
                /* Pushes WiFi info to the far right */
            }

            #wifi-icon {
                margin-right: 5px;
            }

            .card-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                padding: 20px;
                justify-content: center;
                /* Align items to the start */
                align-items: stretch;
                /* Stretch items to fill the container */
            }

            .card {
                background-color: white;
                border-radius: 5px;
                padding: 20px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                flex: 1 1 300px;
                /* flex-grow, flex-shrink, flex-basis */
                /* Min and max width for responsiveness and to avoid too small or large cards */
                min-width: 250px;
                /* Minimum width of the cards */
                max-width: 330px;
                /* Maximum width of the cards, adjust as needed */
            }

            .card h1 {
                margin-top: 0;
            }

            .card p {
                margin-bottom: 5px;
            }

            .version {
                margin-left: 10px;
            }

            .footer {
                background-color: #333;
                /* Dark background for the footer */
                color: white;
                /* Light text color for visibility */
                text-align: center;
                /* Center-align the text */
                padding: 10px 0;
                /* Padding above and below text */
                width: 100%;
                /* Take the full width of the viewport */
                position: fixed;
                left: 0;
                bottom: 0;
            }

            .tabNavigation {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin-top: 20px;
            }

            .tabNavigation button {
                padding: 10px 20px;
                border: none;
                background-color: #333;
                color: white;
                cursor: pointer;
                border-radius: 5px;
                font-size: 16px;
            }

            select {
                width: 100%;
            }

            input {
                width: 100%;
            }

            input[type="checkbox"] {
                width: 10px;
            }
        </style>

        <script src="/chartjs"></script>
    </head>

    <body>
        <div class="content">
            <nav>
                <h1>SensorLink</h1>
                <!-- Mention SensorLink in the title -->
                <div id="status-items">
                    <svg
                        style="color: white; margin-right: 5px"
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        fill="currentColor"
                        class="bi bi-wifi"
                        viewBox="0 0 16 16"
                    >
                        <path
                            d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.444 12.444 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049z"
                            fill="white"
                        ></path>
                        <path
                            d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.455 9.455 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065zm-2.183 2.183c.226-.226.185-.605-.1-.75A6.473 6.473 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.478 5.478 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091l.016-.015zM9.06 12.44c.196-.196.198-.52-.04-.66A1.99 1.99 0 0 0 8 11.5a1.99 1.99 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z"
                            fill="white"
                        ></path>
                    </svg>
                    <span id="ssidBar">{{STA_SSID}}</span>
                    <!-- Display SSID here -->
                    <svg
                        style="margin-left: 10px; margin-right: 5px"
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        fill="currentColor"
                        class="bi bi-clock"
                        viewBox="0 0 16 16"
                    >
                        <path
                            d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"
                        />
                        <path
                            d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"
                        />
                    </svg>
                    <span id="current-time"></span>
                    <!-- Display current time here -->
                    <svg
                        style="
                            color: white;
                            margin-left: 10px;
                            margin-right: 5px;
                        "
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        fill="currentColor"
                        class="bi bi-gear"
                        viewBox="0 0 16 16"
                    >
                        <path
                            d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"
                            fill="white"
                        ></path>
                        <path
                            d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"
                            fill="white"
                        ></path>
                    </svg>
                    <span id="version">{{GIT_COMMIT_HASH}}</span>
                </div>
            </nav>

            <div class="tabNavigation">
                <button class="" onclick="openTab('sensorMonitor')">
                    Sensor Control
                </button>
                <button class="" onclick="openTab('networkSettings')">
                    Network Settings
                </button>
                <button class="" onclick="openTab('mqttSettings')">
                    MQTT Settings
                </button>
                <button class="" onclick="openTab('securitySettings')">
                    Security Settings
                </button>
                <button class="" onclick="openTab('otaSettings')">
                    Firmware Upgrade
                </button>
                <button class="" onclick="rebootDevice()">Reboot Link</button>
            </div>
            <div id="sensorMonitor" class="tab">
                <h2 style="text-align: center">Sensor Control</h2>
                <div class="card-container">
                    <div class="card">
                        <h1>I/O Device 1</h1>
                        <p>Type: Analog Input</p>
                        <p>Channel: ADC1_CHANNEL_0</p>
                        <p>Attentuation: 11dB</p>
                        <p>Value: <span id="sensor1">--</span> mV</p>
                        <canvas
                            id="sensor1Graph"
                            width="400"
                            height="300"
                        ></canvas>
                    </div>
                    <div class="card">
                        <h1>I/O Device 2</h1>
                        <p>Type: Analog Input</p>
                        <p>Channel: ADC1_CHANNEL_1</p>
                        <p>Attentuation: 0dB</p>
                        <p>Value: <span id="sensor2">--</span> mV</p>
                    </div>
                    <div class="card">
                        <h1>I/O Device 3</h1>
                        <p>Type: Digital Output</p>
                        <p>Channel: GPIO_NUM_22</p>
                        <p>State: <span id="led_state">OFF</span></p>
                        <br />
                        <button onclick="toggleLEDON()">ON</button>
                        <button onclick="toggleLEDOFF()">OFF</button>
                    </div>
                </div>
            </div>
            <div id="networkSettings" class="tab" style="display: None">
                <h2 style="text-align: center">Network Settings</h2>
                <div class="card-container">
                    <div class="card">
                        <h1>Connect to Wi-Fi (Station)</h1>
                        <p>
                            Connect the SensorLink to an existing Wi-Fi Network
                            (station mode).
                        </p>
                        <form
                            id="wifi-form"
                            onsubmit="return sendWifiCreds(event)"
                        >
                            <label for="networks">Discovered Networks</label>
                            <select
                                name="networks"
                                id="networks"
                                size="5"
                                onchange="onChange()"
                            ></select>
                            <p id="fetch-state" style="font-size: 12px"></p>
                            <button type="button" onclick="fetchNetworks()">
                                Refresh List
                            </button>
                            <p>
                                <label for="ssid">SSID</label>
                                <input
                                    type="text"
                                    id="ssid"
                                    name="ssid"
                                    required
                                />
                            </p>
                            <p>
                                <label for="password">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    name="password"
                                    required
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Save Wi-Fi Credentials
                                </button>
                            </p>
                        </form>
                    </div>
                    <div class="card">
                        <h1>DHCP/IPv4 Configuration</h1>
                        <p>Select an IPv4 Method.</p>
                        <form
                            id="ipv4-configuration"
                            onsubmit="return setIPConfig(event)"
                        >
                            <label for="ipv4-method">IPv4 Method</label>
                            <select
                                name="ipv4-method"
                                id="ipv4-method"    
                                onchange="onMethodChange()"
                            >
                                <option value="0" selected>DHCP</option>
                                <option value="1">Manual</option>
                            </select>
                            <p>
                                <label
                                    id="ipv4-static-addr-lbl"
                                    for="ipv4-static-addr"
                                    >Address</label
                                >
                                <input
                                    type="text"
                                    id="ipv4-static-addr"
                                    name="ipv4-static-addr"
                                    value="{{STA_STATIC_IP}}"
                                    required
                                />
                            </p>
                            <p>
                                <label
                                    id="ipv4-static-netmask-lbl"
                                    for="ipv4-static-netmask"
                                    >Netmask</label
                                >
                                <input
                                    type="text"
                                    id="ipv4-static-netmask"
                                    name="ipv4-static-netmask"
                                    value="{{STA_NETMASK}}"
                                    required
                                />
                            </p>
                            <p>
                                <label
                                    id="ipv4-static-gateway-lbl"
                                    for="ipv4-static-gateway"
                                    >Gateway</label
                                >
                                <input
                                    type="text"
                                    id="ipv4-static-gateway"
                                    name="ipv4-static-gateway"
                                    value="{{STA_GATEWAY}}"
                                    required
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Save IPv4 Configuration
                                </button>
                            </p>
                        </form>
                    </div>
                    <div class="card">
                        <h1>Access Point (AP)</h1>
                        <p>
                            Set the configuration paramters for the AP
                            (broadcasted) network.
                        </p>
                        <form
                            id="wifi-ap-form"
                            onsubmit="return sendAPWifiCreds(event)"
                        >
                            <p>
                                <label for="ssid">AP SSID</label>
                                <input
                                    type="text"
                                    id="ssid"
                                    name="ssid"
                                    value="{{AP_SSID}}"
                                    required
                                />
                            </p>
                            <p>
                                <label for="password">AP Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    name="password"
                                    value="{{AP_PASSKEY}}"
                                    required
                                />
                            </p>
                            <p></p>
                            <p>
                                Show Password:
                                <input
                                    type="checkbox"
                                    id="show-password"
                                    name="show-password"
                                    onchange="showPassword()"
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Save AP Credentials
                                </button>
                            </p>
                        </form>
                    </div>
                    <div class="card">
                        <h1>Network Status</h1>
                        <p>
                            <b>Wi-Fi Mode:</b>
                            <span id="wifi-mode">{{MODE}}</span>
                        </p>
                        <p>
                            <b>STA Network SSID:</b>
                            <span id="sta-ssid">{{STA_SSID}}</span>
                        </p>
                        <p>
                            <b>AP Network SSID:</b>
                            <span id="ap-ssid">{{AP_SSID}}</span>
                        </p>
                        <p>
                            <b>AP IP Address:</b> <span id="ip">{{AP_IP}}</span>
                        </p>
                        <p>
                            <b>Station IP Address:</b>
                            <span id="ip">{{STA_IP}}</span>
                        </p>
                        <p>
                            <b>MAC Address:</b>
                            <span id="mac">{{MAC_ADDRESS}}</span>
                        </p>
                    </div>
                </div>
            </div>
            <div id="mqttSettings" class="tab" style="display: None">
                <h2 style="text-align: center">MQTT Settings</h2>
                <div class="card-container">
                    <div class="card">
                        <h1>MQTT Broker</h1>
                        <p>
                            Set the configuration parameters for the MQTT
                            Broker.
                        </p>
                        <form
                            id="ap-forms"
                            onsubmit="return sendWifiCreds(event)"
                        >
                            <p>
                                <label for="ap-ssid">Broker Address</label>
                                <input
                                    type="text"
                                    id="ap-ssid"
                                    name="ap-ssid"
                                    required
                                />
                            </p>
                            <p>
                                <label for="password">Broker Username</label>
                                <input
                                    type="ap-password"
                                    id="ap-password"
                                    name="ap-password"
                                    required
                                />
                            </p>
                            <p>
                                <label for="password">Broker Password</label>
                                <input
                                    type="ap-password"
                                    id="ap-password"
                                    name="ap-password"
                                    required
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Save MQTT Parameters and Reboot
                                </button>
                            </p>
                        </form>
                    </div>
                    <div class="card">
                        <h1>MQTT Interval</h1>
                        <p>
                            Set the update interval for the MQTT Broker.
                        </p>
                        <form
                            id="ap-forms"
                            onsubmit=""
                        >
                            <p>
                                <label for="ap-ssid">Update Interval (in ms)</label>
                                <input
                                    type="text"
                                    id="ap-ssid"
                                    name="ap-ssid"
                                    required
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Save MQTT Parameters
                                </button>
                            </p>
                        </form>
                    </div>
                </div>
            </div>
            <div id="securitySettings" class="tab" style="display: None">
                <h2 style="text-align: center">Security Settings</h2>
            </div>
            <div id="otaSettings" class="tab" style="display: None">
                <h2 style="text-align: center">Firmware Upgrade</h2>
                <div class="card-container">
                    <div class="card">
                        <h1>Upload Firmware File</h1>
                        <p>
                            Upload a binary firmware file to upgrade the device using the OTA method.
                        </p>
                        <form
                            id="ota-form"
                            onsubmit=""
                        >
                            <p>
                                <label for="firmware">Firmware File</label>
                                <input
                                    type="file"
                                    id="firmware"
                                    name="firmware"
                                    accept=".bin,.bin.gz"
                                    required
                                />
                            </p>
                            <p>
                                <button type="submit">
                                    Upload Firmware
                                </button>
                            </p>
                            <p>
                                <button type="button" onclick="">
                                    Revert Firmware
                                </button>
                            </p>
                    </div>
            </div>
            <script>
                // Function to add new data to the graph
                let labels = []; // Replace with actual labels, if available
                let dataPoints = []; // Initially empty, will be populated with incoming data
                let lastValueAboveThreshold = false; // Edge detection
                let count = 0; // Counter for labels

                function addData(chart, label, data) {
                    if (chart.data.labels.length > 8) {
                        // Limit number of data points
                        chart.data.labels.shift(); // Remove first label
                        chart.data.datasets.forEach((dataset) => {
                            dataset.data.shift(); // Remove first data point
                        });
                    }
                    chart.data.labels.push(label); // Add new label at end
                    chart.data.datasets.forEach((dataset) => {
                        dataset.data.push(data); // Add new data at end
                    });
                    chart.update(); // Update the chart
                }

                // Initialize the chart
                let ctx = document
                    .getElementById("sensor1Graph")
                    .getContext("2d");
                let sensorChart = new Chart(ctx, {
                    type: "line", // Type of chart
                    data: {
                        labels: labels, // X-axis labels
                        datasets: [
                            {
                                label: "Sensor 1 Data", // Legend name
                                data: dataPoints, // Y-axis data
                                fill: false,
                                borderColor: "rgb(75, 192, 192)", // Line color
                                tension: 0.1, // Smoothness of line
                            },
                        ],
                    },
                    options: {
                        animation: {
                            duration: 0,
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: "Timestamp",
                                },
                            },
                            y: {
                                responsive: false, // Prevent chart from
                                animation: false, // Disable animations
                                maintainAspectRatio: false, // Allow custom aspect ratio
                                min: 0, // Minimum value
                                max: 3300, // Maximum value
                                ticks: {
                                    stepSize: 660, // Step size
                                },
                                title: {
                                    display: true,
                                    text: "Voltage (mV)",
                                },
                            },
                        },
                    },
                });

                var loc = window.location,
                    new_uri;
                if (loc.protocol === "https:") {
                    new_uri = "wss:";
                } else {
                    new_uri = "ws:";
                }
                new_uri += "//" + loc.host;
                new_uri += loc.pathname + "ws";

                const ws = new WebSocket(new_uri);

                // Event listener to be called when the WebSocket connection is opened
                ws.onopen = function () {
                    console.log("Connected to the WebSocket server");
                };

                // Event listener to be called when a message is received from the server
                ws.onmessage = function (event) {
                    let receivedData = JSON.parse(event.data);
                    let currentLabel = new Date().toLocaleTimeString(); // Using current time as label

                    let adc = parseInt(receivedData["adc"]);

                    // Add data to the graph
                    addData(sensorChart, currentLabel, adc);

                    if (adc > 3000 && !lastValueAboveThreshold) {
                        // Do something when the value goes above 2000
                        lastValueAboveThreshold = true;
                    } else if (adc < 3000 && lastValueAboveThreshold) {
                        // Do something when the value goes below 3000
                        lastValueAboveThreshold = false;
                        count++;
                    }

                    console.log(receivedData);

                    // Update label and value
                    document.getElementById("sensor1").textContent =
                        receivedData["adc"];

                    document.getElementById("led_state").textContent =
                        receivedData["pin"] ? "ON" : "OFF";
                };

                // Event listener for any errors that occur
                ws.onerror = function (error) {
                    console.log("WebSocket Error: " + error);
                    alert(
                        "Failed to establish connection with the SensorLink Device"
                    );
                };

                // Optionally, handle the WebSocket closing
                ws.onclose = function () {
                    console.log("Disconnected from the WebSocket server");
                    alert("Lost connection with the SensorLink Device");
                };

                function updateTime() {
                    const now = new Date();
                    const formattedTime = now.toLocaleTimeString();
                    document.getElementById("current-time").textContent =
                        formattedTime;
                }

                function toggleLEDOFF() {
                    // Toggle off using AJAX http GET request with pin number and state
                    var xhttp = new XMLHttpRequest();
                    xhttp.open("GET", "/led?pin=22&state=0", true);
                    xhttp.send();
                }

                function toggleLEDON() {
                    // Toggle on using AJAX http GET request with pin number and state
                    var xhttp = new XMLHttpRequest();
                    xhttp.open("GET", "/led?pin=22&state=1", true);
                    xhttp.send();
                }

                function showPassword(e) {
                    if (document.getElementById("show-password").checked) {
                        document.getElementById("wifi-ap-form").password.type = "text";
                    } else {
                        document.getElementById("wifi-ap-form").password.type =
                            "password";
                    }
                }

                function setIPConfig(e) {
                    const form = document.getElementById("ipv4-configuration");
                    const mode= form["ipv4-method"].value;
                    const addr = form["ipv4-static-addr"].value;
                    const netmask = form["ipv4-static-netmask"].value;
                    const gateway = form["ipv4-static-gateway"].value;

                    e.preventDefault();

                    const data =
                        "mode=" +
                        encodeURIComponent(mode) +
                        "&static_ip=" +
                        encodeURIComponent(addr) +
                        "&subnet=" +
                        encodeURIComponent(netmask) +
                        "&gateway=" +
                        encodeURIComponent(gateway);

                    fetch(`/ipv4-config`, {
                        method: "POST",
                        body: data,
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                        },
                    })
                        .then((response) => {
                            if (!response.ok) {
                                alert("Failed to save IPv4 configuration");
                            } else {
                                console.log(response);
                                alert("IPv4 configuration saved successfully");
                            }
                        })
                        .catch((error) => {
                            console.error(error);
                            alert("Failed to save IPv4 configuration");
                        });


                }

                function fetchNetworks() {
                    const networkList = document.getElementById("networks");
                    networkList.innerHTML = "";

                    document.getElementById("fetch-state").textContent = "Fetching Networks...";

                    fetch("/networks", {
                        method: "GET",
                    })
                        .then((response) => {
                            if (!response.ok) {
                                alert("Failed to fetch networks");
                            } else {
                                response.json().then((data) => {
                                    console.log(data);
                                    data.forEach((network) => {
                                        const option =
                                            document.createElement("option");
                                        option.value = network;
                                        option.textContent = network;
                                        networkList.appendChild(option);
                                    });
                                });

                                document.getElementById("fetch-state").textContent = "Successfully fetched networks";

                                setTimeout(() => {
                                    document.getElementById("fetch-state").textContent = "";
                                }, 5000);
                            }
                        })
                        .catch((error) => {
                            console.error(error);
                            alert("Failed to fetch networks");          
                        document.getElementById("fetch-state").textContent = "Failed to fetch networks";
                        });
                }

                function rebootDevice() {
                    fetch("/restart", { method: "GET" })
                        .then((response) => {
                            if (response.ok) {
                                alert(
                                    "Device is rebooting! Please wait for the device to come back online."
                                );
                            } else {
                                alert("Failed to reboot link!");
                            }
                        })
                        .catch((err) => {
                            console.log(err);
                            alert("Failed to reboot link!");
                        });
                }

                function onMethodChange() {
                    const method = document.getElementById("ipv4-method").value;
                    if (method === "0") {
                        document.getElementById(
                            "ipv4-static-addr"
                        ).style.display = "none";
                        document.getElementById(
                            "ipv4-static-netmask"
                        ).style.display = "none";
                        document.getElementById(
                            "ipv4-static-gateway"
                        ).style.display = "none";
                        document.getElementById(
                            "ipv4-static-addr-lbl"
                        ).style.display = "none";
                        document.getElementById(
                            "ipv4-static-netmask-lbl"
                        ).style.display = "none";
                        document.getElementById(
                            "ipv4-static-gateway-lbl"
                        ).style.display = "none";
                    } else if (method === "1") {
                        document.getElementById(
                            "ipv4-static-addr"
                        ).style.display = "block";
                        document.getElementById(
                            "ipv4-static-netmask"
                        ).style.display = "block";
                        document.getElementById(
                            "ipv4-static-gateway"
                        ).style.display = "block";
                        document.getElementById(
                            "ipv4-static-addr-lbl"
                        ).style.display = "block";
                        document.getElementById(
                            "ipv4-static-netmask-lbl"
                        ).style.display = "block";
                        document.getElementById(
                            "ipv4-static-gateway-lbl"
                        ).style.display = "block";
                    }
                }

                function openTab(tabName) {
                    var i;
                    var x = document.getElementsByClassName("tab");
                    console.log(x);
                    for (i = 0; i < x.length; i++) {
                        x[i].style.display = "none";
                    }
                    document.getElementById(tabName).style.display = "block";
                }

                function sendWifiCreds(e) {
                    const form = document.getElementById("wifi-form");
                    const ssid = form.ssid.value;
                    const password = form.password.value;
                    e.preventDefault();

                    const data =
                        "ssid=" +
                        encodeURIComponent(ssid) +
                        "&password=" +
                        encodeURIComponent(password);
                    // Store them as query parameters not as JSON
                    fetch(`/wifi-save-creds`, {
                        method: "POST",
                        body: data,
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                        },
                    })
                        .then((response) => {
                            if (!response.ok) {
                                alert("Failed to save Wi-Fi credentials");
                            } else {
                                console.log(response);
                                alert(
                                    "Wi-Fi credentials saved successfully. Please reboot link to apply changes."
                                );
                            }
                        })
                        .catch((error) => {
                            console.error(error);
                            alert("Failed to save Wi-Fi credentials");
                        });

                    return false;
                }

                function sendAPWifiCreds(e) {
                    const form = document.getElementById("wifi-ap-form");
                    const ssid = form.ssid.value;
                    const password = form.password.value;
                    e.preventDefault();

                    const data =
                        "ssid=" +
                        encodeURIComponent(ssid) +
                        "&password=" +
                        encodeURIComponent(password);
                    // Store them as query parameters not as JSON
                    fetch(`/wifi-save-ap-creds`, {
                        method: "POST",
                        body: data,
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                        },
                    })
                        .then((response) => {
                            if (!response.ok) {
                                alert("Failed to save Wi-Fi credentials");
                            } else {
                                console.log(response);
                                alert(
                                    "Wi-Fi credentials saved successfully. Please reboot link to apply changes."
                                );
                            }
                        })
                        .catch((error) => {
                            console.error(error);
                            alert("Failed to save Wi-Fi credentials");
                        });

                    return false;
                }

                function onChange() {
                    console.log("onChange");
                    console.log(document.getElementById("networks").value);
                    console.log(document.getElementById("ssid"));
                    document.getElementById("ssid").value =
                        document.getElementById("networks").value;
                }

                function setInitialMethod() {
                    document.getElementById("ipv4-method").value = "{{STA_IP_MODE}}";
                    onMethodChange();
                }

                ws.onclose = function () {
                    console.log("Disconnected from the WebSocket server");
                    // RECONNECT
                    setTimeout(() => {
                        ws = new WebSocket(new_uri);
                    }, 5000);
                };


                updateTime();
                setInitialMethod();
                setInterval(updateTime, 1000);
            </script>
        </div>
        <footer class="footer">
            <p>
                Warning! This is an early development build. Some features may
                not work as expected.
            </p>
        </footer>
    </body>
</html>
